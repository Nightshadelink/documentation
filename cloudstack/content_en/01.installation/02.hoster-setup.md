---
url: /installation/setup-for-hosters/
next: /components/
prev: /installation/simple-setup/
title: Setup for Hosters (CSPs)
keywords:
    - Cloud Setup for Hosters
    - Cloud Installation
    - ISP Setup
    - cloudstack
    - Installation cloud telephony system
description: This is a step by step guide to an example setup for hosters - i.e. ideal for ISPs.
toc: true
weight: 02

---


This is a step by step guide to an example setup for hosters. If you are only testing the cloudstack or only operate a small number of instances, please refer to the chapter entitled "Simple Setup".

## System Requirements

The mobydick cloudstack can be directly installed on x86 hardware or operated within a virtual machine.

The following Hypervisors are currently supported:

+ VMWare ESX

{{% notice tip %}}
Currently the cloudstack does not support a multi-host setup. For this purpose, hosters are recommended to use the Hypervisor HA functionality.
{{% /notice %}}

### Determing RAM Requirements

The limiting factor regarding a cloudstack installation is normally not the system CPU or Disk Space but rather the RAM.

The RAM requirements can be determined as follows:

> **2048 MB** System + **512 MB** x No. of mobydick instances + **512 MB** x No. of proxies

In our example, we will setup two security zones and therefore will also require two proxies. Should you wish to start a maximum of 100 mobydick instances on this host, then you will require the following:

> 2048 MB System + 512 MB x **100** + 512 MB x 2 = **54 GB RAM** (approximately)

{{% notice tip %}}
The **512 MB RAM** pro mobydick instance is an average (perhaps conservative) **guideline**. This may vary according to the type and scope of your instances, number of users etc.
{{% /notice %}}

### Network Preparation

![Network setup example](/hoster_setup_network.png)

Each security zone requires it's own proxy instance. Of course, it is possible to setup any number of zones. For ease of understanding purposes, we are limiting our example to only two zones:

#### Security Zone dmz

Customers should be able to access the following services on their mobydick instance via this proxy:

* Encrypted telephony provisioning
* Secure IP telephone registration and voice encryption
* mobydick Desktop and mobile client login

In this example, we do not permit a customer direct over the internet access to their mobydick instance management UI.

The services are accessible under the following DNS name:
```
mobydick.example.com
```

#### Security Zone Trusted

This network is not accessible via the internet and is used for:

* cloudstack management
* Administration of the individual mobydick instances

In addition to this, the outgoing network traffic, e.g. the communication of a mobydick instance with a SIP provider, is routed over this network.

The services are accessible under the following DNS name:
```
mobydick-trusted.example.com
```

#### Certificates

All communication over our proxies will be SSL encrypted. By creating a new proxy, it will automatically generate a "self-signed" certificate.

As a minimum, you should apply an official certificate for `mobydick.example.com`.

#### Firewall Adjustments

The following ports will be required by the corresponding services and therefore must be considered in the Firewall setup.

#### dmz (mobydick.example.com)

| Port | Description |
| ---- | ------------ |
| TCP **8884**  | IP Telephone Provisioning |
| TCP **5222** | mobydick desktop and mobile client acces |
| TCP **5061** | SIP-TLS - secure SIP communication |
| UDP **30000 - 35000** | SRTP - encrypted voice data |

#### trusted (mobydick-trusted.example.com)

| Port | Description |
| ---- | ------------ |
| TCP **8443**  | cloudstack management UI |
| TCP **443** | mobydick instance(s) management UI |

## Installation

### Sourcing the Installation Medium

Installation Media

The official current cloudstack ISO is available to download from the download section of our homepage.

Should you wish to operate the cloudstack from within a virtual machine, you can use the ISO file directly as the installation media.

In order to install on an x86 Hardware, generate an installations CD/DVD or USB stick from the ISO file.

### Setup Process

Boot your machine using the installations media.

During the setup process, please follow the on-screen instructions.

#### Network

Enter your local network settings and IP address. Later, every cloudstack component will be reachable from this IP address.

#### Disk Space
{{% notice warning %}}
During the setup process, the cloudstack will delete all the data stored on the named hard disk!
{{% /notice %}}

### Initialisation

The setup process will end after rebooting and you will be able to continue with the initialisation of the web User Interface.

Access is granted via `https` and the port `8443`. This is also indicated in the cloudstack welcome screen. For example, in our setup:

```
Welcome to the mobydick cloudstack

In order to access the webui, please visit https://10.5.1.10:8443
```

Enter the URL `https://10.5.1.10:8443` (adjust IP Address accordingly)
into your browser search bar.

The following credentials will now be required:

#### Admin User

The cloudstack will now ask you to enter the `admin` password. The
`admin` credentials can be used both for accessing the cloudstack web UI as well as logging in per SSH.

#### 1st mobydick Instance

In addition to the first Proxy, the assistant will also add the first mobydick instance for you. As the instance name, we suggest your company name or that of your first customer. In our example, we are calling our first instance `pascom`.

The instance name will later become a component of the URL providing access to this mobydick instance (e. g. `https://mobydick-trusted.example.com/pascom`) and is also required by end users in order to login to the mobydick client
(e. g. `username@pascom`).

The instance name is also visible to every users and therefore should be selected with care, particularly as it is not possible to alter the instance name at a later date. However, you will be able to delete the instance and add a new instance and import your old instance data using the backup mechanism.

Later on you will be able to add more instances.

#### Completing the Initialisation

As soon as the assistant has finished, you will be redirected to the login screen where you will be able to login in using the `admin` user than you just created.

## Configuration

The initialisation process has already added the mobydick instance `pascom` as well as the first proxy. Now the configuration of the first proxy needs to be modified to `mobydick-trusted.example.com`. In addition, we will also need to create an additional proxy for the `dmz` and make it reachable via `mobydick.example.com`.

### Trusted Proxy Adjustments

Click on **Proxy instances** in the left hand menu within the cloudstack management UI and **Stop** the Proxy. You can now **Edit** the proxy and will need to deactivate the following services by switching them to **off**:

* Phone Provisioning
* VoIP SIP
* Allow Client (XMPP) Connections

In doing so and as recommended, only the mobydick instance management UI is reachable via this proxy.

Under **Proxy DNS Name (FQDN)**, enter `mobydick-trusted.example.com` and upload an appropriate certificate for this Domain.

Save your settings via the **Save** option and restart the proxy via the **Start** option.

### Creating dmz Proxy

For this, you will need another network card which can be used exclusively for this Proxy e.g. eth1.

Add a new proxy instance via **Add proxy** and name it `dmz`.
Also set the **Network mode** to `manual` and configure the network. For example:

|Field|Value|
|---|---|
|Network Interface|eth1|
|Network IP-Address|81.27.50.10|
|Network Netmask|255.255.255.0|
|Network Gateway|81.27.20.254|

Deactivate the **Manage mobydick Instances** option be selecting `off`.
In doing so the mobydick instance management UIs will no longer be accessible via the internet.

Under **Proxy DNS Name (FQDN)**, enter `mobydick-trusted.example.com` and upload an appropriate certificate for this Domain.

Save your settings via the **Save** option and restart the proxy via the **Start** option.

## Testing

The setup is now complete and the cloudstack is ready for operation. The following tests can help you in getting to know the cloudstack in more detail as well as helping validate your network configuration.

### Accessing the 1st mobydick Instance

Using the URL `https://mobydick-trusted.example.com/pascom` you should be able to access the mobydick instance web UI. To log in use the username `admin` and password `mobydick`.

#### Changing the Admin Password

By every newly created instance, an admin user is automatically added.
Use this opportunity to change the `admin` password for this instance.

To do this is, simply select the menu options `Users > User List` then select the `admin` user and enter a new password.

After saving, an entry will appear in the Task List (Job Box - top of screen) prompting you to apply new telephony settings. Start the job by clicking on the `green tick` (Apply).

#### Adding Users

For additional tests, you will need to add two new users. The new users will automatically have a mobydick software assigned to them which the users can then use via the mobydick desktop client.

#### Apply Jobs

After saving, an entry will appear in the Task List (Job Box - top of screen) prompting you to apply new telephony settings. Start the job by clicking on the `green tick` (Apply).

### mobydick Client Tests

Log out of the mobydick instance and in the login screen you will find the **Service** menu tab under which you can download the mobydick desktop client for Windows,
Mac or Linux. Simply download and install the clients you require.

#### User Login

After the installation, start the mobydick desktop client. You will now be required to enter the following information:

| Field | Description | Example |
| --- | --- | --- |
| Username | username@mobydick-instancename | jbarton@pascom |
| Password | The user's password | ****** |
| Server | DNS Name of Proxy | mobydick.example.com |

Repeat this process for the second user by using a second workstation.

#### Audio-Hardware Configuration

Within the mobydick client, go to the menu option `Settings > mobydick Softphone` and
configure your audio hardware accordingly. If necessary, connect a headset to your computer.

#### First Phone Call

Within the mobydick client, you should now be able to see the other user(s) in the contact list. By clicking on the green handset, you will start calling that user enabling you to test your audio connection.

### IP Telephone Provisioning Tests

mobydick is in the position to automatically and securely configure IP telephones from the following manufacturers; Snom, Yealink and Auerswald.

#### Adding Telephones

Log back into the required mobydick instance and navigate to the menu option `Devices >
Device List`. You will now be able to add a new IP telephone here. Enter the telephones MAC address and save your new settings.

#### Copy the Provisioning URL

Select the phone and then choose the menu option `Actions > Provisioning URL`.
The system will now list the provisioning URLs for every proxy, e.g.:
```
https://mobydick.example.com:8884/p/xJyj5_l9R0s6OlOZh36GcY1ximO0x6qLa9UjVulaxYI=+
```

#### Entering the Provisioning URL on a Phone

Surf to the Telephone Web UI and then enter the URL under the correct setting. The telephone should now reboot and will only be available to this mobydick instance.

After the successful provisioning, you should be able to see the exact model of the telephone within the device list and now you will be able to assign this device to a user.
