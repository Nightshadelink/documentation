---
url: installation/setup-fuer-hoster
next: /komponenten/
prev: /installation/einfaches-setup/
title: Setup für Hoster (CSP)
keywords: 
    - Cloud Setup für Hoster
    - Cloud Installation
    - ISP Setup
    - cloudstack 
    - Installation cloud telefonanlage
description: Diese Anleitung führt schrittweise durch ein Beispielsetup für Hoster. Ideal für ISPS.
toc: true
weight: 02

---


Diese Anleitung führt schrittweise durch ein Beispielsetup für Hoster.
Wenn Sie den cloudstack testen möchten oder nur wenige mobydick Instanzen
betreiben, dann lesen Sie bitte das Kapitel "Einfaches Setup".

## Systemvoraussetzungen

Den mobydick cloudstack können Sie entweder direkt auf x86-Hardware oder in
einer virtuellen Maschine betreiben.

Aktuell werden folgende Hypervisoren unterstützt:

+ VMWare ESX

{{% notice tip %}}
Aktuell untersützt der cloudstack kein multi-host Setup. Daher empfiehlt es sich
für Hoster das HA eines Hypervisors zu nutzen.
{{% /notice %}}

### Ermittlung RAM-Bedarf

Der limitierende Faktor einer cloudstack Installation ist in der Regel nicht
die CPU oder Festplatte eines System sondern der RAM.

Der RAM-Bedarf wird wie folgt ermittelt:

> **2048 MB** System + **512 MB** x Anzahl mobydick Instanzen + **512 MB** x Anzahl Proxies

In unserem Beispiel werden wir zwei Sicherheitszonen einrichten und somit zwei
Proxy-Instanzen benötigen. Wenn Sie beispielsweise maximal 100 mobydick Instanzen
auf diesem Host hochfahren möchten benötigen Sie:

> 2048 MB System + 512 MB x **100** + 512 MB x 2 = **54 GB RAM** (gerundet)

{{% notice tip %}}
Die **512 MB RAM** pro mobydick Instanz ist ein durchschnittlicher (eher
konservativen) **Richtwert**. Dieser kann nach Art und Umfang Ihrer Instanzen-, Benutzeranzahl, etc. entsprechend variieren.
{{% /notice %}}

### Netzwerk vorbereiten

![Netzwerk Setup Beispiel](/hoster_setup_network.png)

Für jede Sicherheitszone wird eine eigene Proxy-Instanz benötigt. Selbstverständlich können Sie beliebig viele dieser Zonen einrichtet. Um das Beispiel
übersichtlich zu halten beschränken wir uns auf zwei:

#### Sicherheitszone dmz

Auf diesen Proxy sollen Kunden direkt über das Internet auf folgende Dienste
der jeweiligen mobydick Instanzen zugreifen können:

* Verschlüsselte Provisionierung der Telefone
* IP-Telefone sicher registrieren und Gespräche verschlüsseln
* Anmeldung der mobydick Desktop- und Mobile-Clients

Auf einen Zugriff der Kunden auf die jeweilige Management-UI der mobydick
Instanzen direkt über das Internet verzichten wir in diesem Beispiel.

Die Dienste sind unter folgendem DNS Namen erreichbar:
```
mobydick.example.com
```

#### Sicherheitszone trusted

Dieses Netzwerk ist nicht direkt aus dem Internet erreichbar. Wir verwenden es
für:

* Verwaltung des cloudstack
* Administration der einzelnen mobydick Instanzen

Außerdem wird der ausgehende Netzwerk-Verkehr z. B. die Kommunikation einer
mobydick Instanz mit einem SIP-Provider, über dieses Netzwerk geleitet.  

Die Dienste sind unter folgendem DNS Namen erreichbar:
```
mobydick-trusted.example.com
```

#### Zertifikate

Sämtliche Kommunikation über unsere Proxies wird per SSL verschlüsselt. Erstellen
Sie einen neuen Proxy generiert dieser automatisch ein "self-signed"-Zertifikat.

Zumindest für `mobydick.example.com` sollten Sie offizielle Zertifikate beantragen.

#### Firewall Anpassungen

Folgende Ports werden von den jeweiligen Diensten benötigt und müssen in Ihrer
Firewall berücksichtig werden.

#### dmz (mobydick.example.com)

| Port | Beschreibung |
| ---- | ------------ |
| TCP **8884**  | Provisionierung der IP-Telefone |
| TCP **5222** | mobydick Desktop- und Mobile-Client-Zugriffe |
| TCP **5061** | SIP-TLS - sichere SIP-Kommunikation |
| UDP **30000 - 35000** | SRTP - verschlüsselte Sprachdaten |

#### trusted (mobydick-trusted.example.com)

| Port | Beschreibung |
| ---- | ------------ |
| TCP **8443**  | Management-UI des cloudstack |
| TCP **443** | Management-UIs der mobydick Instanzen |

## Installation

### Installationsmedium besorgen

Das aktuelle cloudstack ISO steht offiziell im Download-Bereich unserer Homepage
zum Herunterladen zur Verfügung.

Wollen Sie den cloudstack in einer virtuellen Maschine betreiben können Sie das
ISO direkt als Installationsmedium verwenden.

Für eine Installation auf x86-Hardware erzeugen Sie aus dem ISO bitte entweder
eine CD/DVD oder einen USB-Stick als Installationsmedium.

### Setup durchführen

Booten Sie die Maschine vom Installationsmedium.

Während des Setup-Prozesses folgen Sie bitte den Anweisungen am Bildschirm.

#### Netzwerk

Vergeben Sie hier die Einstellungen und IP-Adresse aus dem trusted Netzwerk.

#### Festplatte
{{% notice warning %}}
Der cloudstack löscht während des Setups alle auf der Festplatte befindliche
Daten!
{{% /notice %}}

### Initialisierung

Nach dem Reboot ist das Setup beendet und Sie können mit der Initialisierung
über die Weboberfläche fortfahren.

Der Zugriff erfolgt über `https` und den port `8443`. Dies können Sie auch
dem Willkommens-Bildschirm der cloudstack Konsole entnehmen. In unserem Beispiel:

```
Welcome to the mobydick cloudstack

In order to access the webui, please visit https://10.5.1.10:8443
```

Geben Sie die URL `https://10.5.1.10:8443` (IP-Adresse entsprechend anpassen)
in Ihren Browser ein.

Dort werden folgenden Eingaben abgefragt:

#### Admin Benutzer

Der cloudstack wird Sie nun zur Vergabe des `admin` Passwortes auffordern. Den
`admin` können Sie sowohl für die cloudstack Management-UI als auch für den Login per
ssh verwenden.

#### mobydick Instanz

Neben dem ersten Proxy legt der Assistent auch gleichzeitig die erste mobydick
Instanz an. Als Instanzname bietet sich z. B. Ihr Firmenname oder der des ersten
Kunden an. In unserem Beispiel nennen wir die ersten Instanz `pascom`.

Der Instanzname ist später auch Bestandteil der URL um auf diese mobydick
zuzugreifen (z. B. `https://mobydick-trusted.example.com/pascom`) oder muss
vom Endbenutzer bei der Anmeldung am mobydick Desktop und Mobile-Client mit
angegeben werden (z. B. `benutzer@pascom`).

Der Instanzname ist also für jeden Benutzer sichtbar und sollte daher sorgsam
gewählt werden. Eine spätere Änderung des Instanznamen ist nicht möglich. Jedoch
können Sie die Instanz löschen, eine neue anlegen und die Daten per Backup
übertragen.

Später können Sie jederzeit weitere Instanzen hinzufügen.

#### Initialisierung abschließen

Sobald der Assistent seine Arbeit abgeschlossen hat werden Sie zur Login-Maske
weiter geleitet. Dort können Sie sich mit dem zuvor erstellen `admin` Benutzer
anmelden.

## Konfiguration

Der Initialisierungsprozess hat bereits die mobydick Instanz `pascom` und den
ersten Proxy angelegt. Nun passen wir die Konfiguration des ersten Poxies an
und verwenden diesen für `mobydick-trusted.example.com`. Außerdem erstellen
wir einen weiteren Proxy für die dmz und machen diesen unter `mobydick.example.com`
erreichbar.

### Trusted Proxy anpassen

Klicken Sie in der cloudstack Management-UI im linken Menü auf **Proxy instances**
und stoppen **Stop** Sie den Proxy. Editieren Sie diesen nun **Edit** und
deaktivieren Sie folgende Dienste in dem Sie diese auf **off** stellen:

* Phone Provisioning
* VoIP SIP
* Allow Client (XMPP) Connections

Dadurch steht auf diesem Proxy, wie gewünscht, nur noch das Management-UI der
mobydick-Instanzen zur Verfügung.

Tragen Sie unter **Proxy DNS Name (FQDN)** `mobydick-trusted.example.com` ein
und laden Sie das zur Domain passende Zertifikat hoch.

Speichern Sie die Einstellungen **Save** und starten Sie den Proxy
erneut **Start**.

### dmz Proxy erstellen

Hierfür benötigen Sie eine eigene Netzwerkkarte die exklusiv für diesen Proxy
verwendet werden kann, z. B. eth1.

Fügen Sie eine neue Proxy-Instanz hinzu **Add proxy** und nennen diese `dmz`.
Außerdem stellen Sie **Network mode** auf `manual` und konfigurieren das
Netzwerk. In unserem Beispiel:

|Feld|Wert|
|---|---|
|Network Interface|eth1|
|Network IP-Address|81.27.50.10|
|Network Netmask|255.255.255.0|
|Network Gateway|81.27.20.254|

Deaktivieren Sie **Manage mobydick Instances** in dem Sie es auf `off` stellen.
Somit sind die Management-UIs der mobydick Instanzen nicht über das Internet
erreichbar.

Tragen Sie unter **Proxy DNS Name (FQDN)** `mobydick-trusted.example.com` ein
und laden Sie das zur Domain passende Zertifikat hoch.

Speichern Sie die Einstellungen **Save** und starten Sie den Proxy
erneut **Start**.

## Testen

Das Setup ist nun abgeschlossen und der cloudstack betriebsbereit. Die folgenden
Tests helfen Ihnen dabei den cloudstack besser kennen zu lernen und die
Netzwerkkonfiguration zu validieren.

### Zugriff auf die erste mobydick Instanz

Mit der URL `https://mobydick-trusted.example.com/pascom` sollten Sie auf die mobydick
Web-UI der ersten Instanz zugreifen können. Melden Sie sich dort mit dem
Benutzernamen `admin` und dem Passwort `mobydick` an.

#### Admin Passwort ändern

In allen neu erstellen Instanzen wird dieser Benutzer automatisch angelegt.
Nutzen Sie daher die Gelegenheit und ändern das Passwort des `admin` für diese
Instanz ab.

Bearbeiten Sie hierzu im Menü `Benutzer > Benutzerliste` den `admin` Benutzer
und vergeben Sie ein neues Passwort.

Nach dem Speichern erscheint in der Job-Box (oben) ein entsprechender Eintrag
die Telefonie anzuwenden. Starten Sie den Job durch einen Klick auf den `grünen
 Haken` (Anwenden).

#### Benutzer anlegen

Legen Sie für die weiteren Test zwei neue Benutzer an. Mit den Benutzern werden
automatisch auch mobydick Softphones mit angelegt die Sie über den mobydick
Desktop-Client nutzen können.

#### Jobs Anwenden

Nach dem Speichern von Änderungen erscheint in der Job-Box (oben) ein
entsprechender Eintrag die Telefonie anzuwenden. Starten Sie den Job durch
einen Klick auf den `grünen Haken`.

### mobydick Client testen

Melden Sie sich von der mobydick Instanz ab. In der Anmeldemaske finden Sie
das Tab **Service**. Laden Sie hier den mobydick Desktop-Client für Windows,
Mac oder Linux herunter und installieren Sie diesen.

#### Benutzer anmelden

Nach der Installation starten Sie den mobydick Desktop-Client. Sie werden
aufgefordert Folgende Daten anzugeben

| Feld | Beschreibung | Beispiel |
| --- | --- | --- |
| Benutzername | benuterzname@mobydick-instanzname | mpasquay@pascom |
| Passwort | Das Passwort des Benutzers | ****** |
| Server | DNS Name des Proxies | mobydick.example.com |

Wiederholen Sie den Vorgang für den zweiten Benutzer an einem anderen
Arbeitsplatz.

#### Audio-Hardware konfigurieren

Gehen Sie im mobydick Client auf `Einstellungen > mobydick Softphone` und
konfigurieren Sie die Audio Hardware entsprechend. Schließen Sie ggf. ein
Headset an Ihren Computer.

#### Erstes Telefonat

Im mobydick Client sollten Sie jetzt jeweils den anderen Benutzer in der
Kontakt-Liste sehen. Durch Klicken auf den grünen Hörer rufen Sie den Benutzer an.
Testen Sie die Audio-Verbindung.

### IP-Telefon Provisionierung Testen

Für die Hersteller snom, Yealink und Auerswald ist mobydick in der Lage
IP-Telefone automatisch und verschlüsselt zu konfigurieren.

#### Telefon anlegen

Loggen Sie sich in die mobydick Instanz ein und gehen zu `Endgeräte >
Geräteliste`. Dort fügen Sie ein neues IP-Telefon hinzu. Geben Sie die MAC-Adresse
des Telefones an und speichern Sie.

#### Provisionierungs-URL Kopieren

Markieren Sie das Telefon und wählen Sie `Aktionen > Provisioning URL`.
Das System zeigt Ihnen in einer Liste Provisionierungs-URLs für jeden Proxy an.
z. B.:
```
https://mobydick.example.com:8884/p/xJyj5_l9R0s6OlOZh36GcY1ximO0x6qLa9UjVulaxYI=+
```

#### Provisionierungs-URL am Telefon eintragen

Browsen Sie nun auf das Web-UI des Telefones und tragen dort die URL ein. Das
Telefon sollte nun rebooten und steht anschließend dieser mobydick Instanz zur
Verfügung.

Nach erfolgreicher Provisionierung sollten Sie in der Geräteliste das genaue
Modell des Telefons sehen. Teilen Sie das Gerät nun einem Benutzer zu.
